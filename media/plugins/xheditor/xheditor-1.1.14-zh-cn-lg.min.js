(function(e,Y){if(window.xheditor)return false;var I=navigator.userAgent.toLowerCase(),Ba=I.indexOf("mobile")!==-1,J=e.browser,pa=parseFloat(J.version),h=J.msie,qa=J.mozilla,P=J.safari,Ca=J.opera,eb=I.indexOf(" adobeair/")>-1,Da=/OS 5(_\d)+ like Mac OS X/i.test(I);e.fn.xheditor=function(h){if(Ba&&!Da)return false;var t=[];this.each(function(){if(e.nodeName(this,"TEXTAREA"))if(h===false){if(this.xheditor)this.xheditor.remove(),this.xheditor=null}else if(this.xheditor)t.push(this.xheditor);else{var o=/({.*})/.exec(e(this).attr("class"));if(o){try{o=eval("("+o[1]+")")}catch(m){}h=e.extend({},o,h)}o=new ra(this,h);if(o.init())this.xheditor=o,t.push(o)}});t.length===0&&(t=false);t.length===1&&(t=t[0]);return t};var Z=0,Q=false,sa=true,ta=false,Sa=false,m,$,aa,ba,K,Ea,ca,Fa,Ga,Ha,z;e("script[src*=xheditor]").each(function(){var e=this.src;if(e.match(/xheditor[^\/]*\.js/i))return z=e.replace(/[\?#].*$/,"").replace(/(^|[\/\\])[^\/]*$/,"$1"),false});if(h){try{document.execCommand("BackgroundImageCache",false,true)}catch(qb){}(I=e.fn.jquery)&&I.match(/^1\.[67]/)&&(e.attrHooks.width=e.attrHooks.height=null)}var fb={27:"esc",9:"tab",32:"space",13:"enter",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"},Ta="#FFFFFF,#CCCCCC,#C0C0C0,#999999,#666666,#333333,#000000,#FFCCCC,#FF6666,#FF0000,#CC0000,#990000,#660000,#330000,#FFCC99,#FF9966,#FF9900,#FF6600,#CC6600,#993300,#663300,#FFFF99,#FFFF66,#FFCC66,#FFCC33,#CC9933,#996633,#663333,#FFFFCC,#FFFF33,#FFFF00,#FFCC00,#999900,#666600,#333300,#99FF99,#66FF99,#33FF33,#33CC00,#009900,#006600,#003300,#99FFFF,#33FFFF,#66CCCC,#00CCCC,#339999,#336666,#003333,#CCFFFF,#66FFFF,#33CCFF,#3366FF,#3333FF,#000099,#000066,#CCCCFF,#9999FF,#6666CC,#6633FF,#6600CC,#333399,#330099,#FFCCFF,#FF99FF,#CC66CC,#CC33CC,#993399,#663366,#330033".split(","),gb=[{n:"p",t:"\u666e\u901a\u6bb5\u843d"},{n:"h1",t:"\u6807\u98981"},{n:"h2",t:"\u6807\u98982"},{n:"h3",t:"\u6807\u98983"},{n:"h4",t:"\u6807\u98984"},{n:"h5",t:"\u6807\u98985"},{n:"h6",t:"\u6807\u98986"},{n:"pre",t:"\u5df2\u7f16\u6392\u683c\u5f0f"},{n:"address",t:"\u5730\u5740"}],hb=[{n:"\u5b8b\u4f53",c:"SimSun"},{n:"\u4eff\u5b8b\u4f53",c:"FangSong_GB2312"},{n:"\u9ed1\u4f53",c:"SimHei"},{n:"\u6977\u4f53",c:"KaiTi_GB2312"},{n:"\u5fae\u8f6f\u96c5\u9ed1",c:"Microsoft YaHei"},{n:"Arial"},{n:"Arial Black"},{n:"Comic Sans MS"},{n:"Courier New"},{n:"System"},{n:"Times New Roman"},{n:"Tahoma"},{n:"Verdana"}],R=[{n:"x-small",s:"10px",t:"\u6781\u5c0f"},{n:"small",s:"12px",t:"\u7279\u5c0f"},{n:"medium",s:"16px",t:"\u5c0f"},{n:"large",s:"18px",t:"\u4e2d"},{n:"x-large",s:"24px",t:"\u5927"},{n:"xx-large",s:"32px",t:"\u7279\u5927"},{n:"-webkit-xxx-large",s:"48px",t:"\u6781\u5927"}],ib=[{s:"\u5de6\u5bf9\u9f50",v:"justifyleft"},{s:"\u5c45\u4e2d",v:"justifycenter"},{s:"\u53f3\u5bf9\u9f50",v:"justifyright"},{s:"\u4e24\u7aef\u5bf9\u9f50",v:"justifyfull"}],jb=[{s:"\u6570\u5b57\u5217\u8868",v:"insertOrderedList"},{s:"\u7b26\u53f7\u5217\u8868",v:"insertUnorderedList"}],kb={"default":{name:"\u9ed8\u8ba4",width:24,height:24,line:7,list:{smile:"\u5fae\u7b11",tongue:"\u5410\u820c\u5934",titter:"\u5077\u7b11",laugh:"\u5927\u7b11",sad:"\u96be\u8fc7",wronged:"\u59d4\u5c48",fastcry:"\u5feb\u54ed\u4e86",cry:"\u54ed",wail:"\u5927\u54ed",mad:"\u751f\u6c14",knock:"\u6572\u6253",curse:"\u9a82\u4eba",crazy:"\u6293\u72c2",angry:"\u53d1\u706b",ohmy:"\u60ca\u8bb6",awkward:"\u5c34\u5c2c",panic:"\u60ca\u6050",shy:"\u5bb3\u7f9e",cute:"\u53ef\u601c",envy:"\u7fa1\u6155",proud:"\u5f97\u610f",struggle:"\u594b\u6597",quiet:"\u5b89\u9759",shutup:"\u95ed\u5634",doubt:"\u7591\u95ee",despise:"\u9119\u89c6",sleep:"\u7761\u89c9",bye:"\u518d\u89c1"}}},ja={Cut:{t:"\u526a\u5207 (Ctrl+X)"},Copy:{t:"\u590d\u5236 (Ctrl+C)"},Paste:{t:"\u7c98\u8d34 (Ctrl+V)"},Pastetext:{t:"\u7c98\u8d34\u6587\u672c",h:h?0:1},Blocktag:{t:"\u6bb5\u843d\u6807\u7b7e",h:1},Fontface:{t:"\u5b57\u4f53",h:1},FontSize:{t:"\u5b57\u4f53\u5927\u5c0f",h:1},Bold:{t:"\u52a0\u7c97 (Ctrl+B)",s:"Ctrl+B"},Italic:{t:"\u659c\u4f53 (Ctrl+I)",s:"Ctrl+I"},Underline:{t:"\u4e0b\u5212\u7ebf (Ctrl+U)",s:"Ctrl+U"},Strikethrough:{t:"\u5220\u9664\u7ebf"},FontColor:{t:"\u5b57\u4f53\u989c\u8272",h:1},BackColor:{t:"\u80cc\u666f\u989c\u8272",h:1},SelectAll:{t:"\u5168\u9009 (Ctrl+A)"},Removeformat:{t:"\u5220\u9664\u6587\u5b57\u683c\u5f0f"},Align:{t:"\u5bf9\u9f50",h:1},List:{t:"\u5217\u8868",h:1},Outdent:{t:"\u51cf\u5c11\u7f29\u8fdb"},Indent:{t:"\u589e\u52a0\u7f29\u8fdb"},Link:{t:"\u8d85\u94fe\u63a5 (Ctrl+L)",s:"Ctrl+L",h:1},Unlink:{t:"\u53d6\u6d88\u8d85\u94fe\u63a5"},Anchor:{t:"\u951a\u70b9",h:1},Img:{t:"\u56fe\u7247",h:1},Flash:{t:"Flash\u52a8\u753b",h:1},Media:{t:"\u591a\u5a92\u4f53\u6587\u4ef6",h:1},Hr:{t:"\u63d2\u5165\u6c34\u5e73\u7ebf"},Emot:{t:"\u8868\u60c5",s:"ctrl+e",h:1},Table:{t:"\u8868\u683c",h:1},Source:{t:"\u6e90\u4ee3\u7801"},Preview:{t:"\u9884\u89c8"},Print:{t:"\u6253\u5370 (Ctrl+P)",s:"Ctrl+P"},Fullscreen:{t:"\u5168\u5c4f\u7f16\u8f91 (Esc)",s:"Esc"},About:{t:"\u5173\u4e8e xhEditor"}},Ia={mini:"Bold,Italic,Underline,Strikethrough,|,Align,List,|,Link,Img",simple:"Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,|,Align,List,Outdent,Indent,|,Link,Img,Emot",full:"Cut,Copy,Paste,Pastetext,|,Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,SelectAll,Removeformat,|,Align,List,Outdent,Indent,|,Link,Unlink,Anchor,Img,Flash,Media,Hr,Emot,Table,|,Source,Preview,Print,Fullscreen"};Ia.mfull=Ia.full.replace(/\|(,Align)/i,"/$1");var lb={a:"Link",img:"Img",embed:"Embed"},mb={"<":"&lt;",">":"&gt;",'"':"&quot;","\u00ae":"&reg;","\u00a9":"&copy;"},nb=/[<>"\u00ae\u00a9]/g,ra=function(y,t){function o(a){var a=a.target,b=lb[a.tagName.toLowerCase()];b&&(b==="Embed"&&(b={"application/x-shockwave-flash":"Flash","application/x-mplayer2":"Media"}[a.type.toLowerCase()]),d.exec(b))}function I(a){if(a.which===27)return ta?d.removeModal():Q&&d.hidePanel(),false}function J(){setTimeout(d.setSource,10)}function S(){d.getSource()}function Ua(a){var b,c,f;if(a&&(b=a.originalEvent.clipboardData)&&(c=b.items)&&(f=c[0])&&f.kind=="file"&&f.type.match(/^image\//i))return a=f.getAsFile(),b=new FileReader,b.onload=function(){var a='<img src="'+event.target.result+'">',a=Va(a);d.pasteHTML(a)},b.readAsDataURL(a),false;var i=g.cleanPaste;if(i===0||w||Ja)return true;Ja=true;d.saveBookmark();var a=h?"pre":"div",n=e("<"+a+' class="xhe-paste">\ufeff\ufeff</'+a+">",l).appendTo(l.body),a=n[0];b=d.getSel();c=d.getRng(true);n.css("top",da.scrollTop());h?(c.moveToElementText(a),c.select()):(c.selectNodeContents(a),b.removeAllRanges(),b.addRange(c));setTimeout(function(){var a=i===3,b;if(a)b=n.text();else{var c=[];e(".xhe-paste",l.body).each(function(a,b){e(b).find(".xhe-paste").length==0&&c.push(b.innerHTML)});b=c.join("<br />")}n.remove();d.loadBookmark();if(b=b.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,""))if(a)d.pasteText(b);else if(b=d.cleanHTML(b),b=d.cleanWord(b),b=d.formatXHTML(b),!g.onPaste||g.onPaste&&(b=g.onPaste(b))!==false)b=Va(b),d.pasteHTML(b);Ja=false},0)}function Va(a){var b=g.localUrlTest,c=g.remoteImgSaveUrl;if(b&&c){var f=[],i=0,a=a.replace(/(<img)((?:\s+[^>]*?)?(?:\s+src="\s*([^"]+)\s*")(?: [^>]*)?)(\/?>)/ig,function(a,c,d,e,s){/^(https?|data:image)/i.test(e)&&!/_xhe_temp/.test(d)&&!b.test(e)&&(f[i]=e,d=d.replace(/\s+(width|height)="[^"]*"/ig,"").replace(/\s+src="[^"]*"/ig,' src="'+ua+'img/waiting.gif" remoteimg="'+i++ +'"'));return c+d+s});f.length>0&&e.post(c,{urls:f.join("|")},function(a){a=a.split("|");e("img[remoteimg]",d.doc).each(function(){var b=e(this);L(b,"src",a[b.attr("remoteimg")]);b.removeAttr("remoteimg")})})}return a}function Ka(a){try{d._exec("styleWithCSS",a,true)}catch(b){try{d._exec("useCSS",!a,true)}catch(c){}}}function La(){if(Ma&&!w){Ka(false);try{d._exec("enableObjectResizing",true,true)}catch(a){}if(h)try{d._exec("BackgroundImageCache",true,true)}catch(b){}}}function Ba(a){if(w||a.which!==13||a.shiftKey||a.ctrlKey||a.altKey)return true;a=d.getParent("p,h1,h2,h3,h4,h5,h6,pre,address,div,li");if(a.is("li"))return true;if(g.forcePtag)a.length===0&&d._exec("formatblock","<p>");else return d.pasteHTML("<br />"),h&&a.length>0&&d.getRng().parentElement().childNodes.length===2&&d.pasteHTML("<br />"),false}function Na(){!qa&&!P&&(ka&&A.height("100%").css("height",A.outerHeight()-r.outerHeight()),h&&r.hide().show())}function Da(a){a=a.target;if(a.tagName.match(/(img|embed)/i)){var b=d.getSel(),c=d.getRng(true);c.selectNode(a);b.removeAllRanges();b.addRange(c)}}function L(a,b,c){if(!b)return false;var d="_xhe_"+b;c&&(va&&(c=T(c,va,E)),a.attr(b,E?T(c,"abs",E):c).removeAttr(d).attr(d,c));return a.attr(d)||a.attr(b)}function Oa(){sa&&d.hidePanel()}function ob(a){if(w)return true;var b=a.which,c=fb[b],b=c?c:String.fromCharCode(b).toLowerCase();sKey="";sKey+=a.ctrlKey?"ctrl+":"";sKey+=a.altKey?"alt+":"";sKey+=a.shiftKey?"shift+":"";sKey+=b;var a=la[sKey],f;for(f in a)if(f=a[f],e.isFunction(f)){if(f.call(d)===false)return false}else return d.exec(f),false}function M(a,b){var c=typeof a;return!b?c!="undefined":b==="array"&&a.hasOwnProperty&&a instanceof Array?true:c===b}function T(a,b,c){if(a.match(/^(\w+):\/\//i)&&!a.match(/^https?:/i)||/^#/i.test(a)||/^data:/i.test(a))return a;var d=c?e('<a href="'+c+'" />')[0]:location,c=d.protocol,i=d.host,n=d.hostname,j=d.port,d=d.pathname.replace(/\\/g,"/").replace(/[^\/]+$/i,"");j===""&&(j="80");d===""?d="/":d.charAt(0)!=="/"&&(d="/"+d);a=e.trim(a);b!=="abs"&&(a=a.replace(RegExp(c+"\\/\\/"+n.replace(/\./g,"\\.")+"(?::"+j+")"+(j==="80"?"?":"")+"(/|$)","i"),"/"));b==="rel"&&(a=a.replace(RegExp("^"+d.replace(/([\/\.\+\[\]\(\)])/g,"\\$1"),"i"),""));if(b!=="rel"&&(a.match(/^(https?:\/\/|\/)/i)||(a=d+a),a.charAt(0)==="/")){for(var n=[],a=a.split("/"),p=a.length,d=0;d<p;d++)j=a[d],j===".."?n.pop():j!==""&&j!=="."&&n.push(j);a[p-1]===""&&n.push("");a="/"+n.join("/")}b==="abs"&&!a.match(/^https?:\/\//i)&&(a=c+"//"+i+a);return a=a.replace(/(https?:\/\/[^:\/?#]+):80(\/|$)/i,"$1$2")}function Wa(a,b){return b==="*"||a.match(RegExp(".("+b.replace(/,/g,"|")+")$","i"))?true:(alert("\u4e0a\u4f20\u6587\u4ef6\u6269\u5c55\u540d\u5fc5\u9700\u4e3a: "+b),false)}function Xa(a){var b=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(b))).toFixed(2)+"Byte,KB,MB,GB,TB,PB".split(",")[b]}function N(){return false}var d=this,F=e(y),Ya=F.closest("form"),r,A,U,da,l,ea,fa,Ma=false,w=false,ka=false,Ja=false,Pa,ma=false,Za="",u=null,wa,na=false,Qa=false,ga=null,V=null,O=0,g=d.settings=e.extend({},ra.settings,t),xa=g.plugins,ya=[];xa&&(ja=e.extend({},ja,xa),e.each(xa,function(a){ya.push(a)}),ya=ya.join(","));if(g.tools.match(/^\s*(m?full|simple|mini)\s*$/i)){var $a=Ia[e.trim(g.tools)];g.tools=g.tools.match(/m?full/i)&&xa?$a.replace("Table","Table,"+ya):$a}g.tools.match(/(^|,)\s*About\s*(,|$)/i)||(g.tools+=",About");g.tools=g.tools.split(",");if(g.editorRoot)z=g.editorRoot;eb===false&&(z=T(z,"abs"));if(g.urlBase)g.urlBase=T(g.urlBase,"abs");var ab="xheCSS_"+g.skin,ha="xhe"+Z+"_container",bb="xhe"+Z+"_Tool",cb="xhe"+Z+"_iframearea",db="xhe"+Z+"_iframe",za="xhe"+Z+"_fixffcursor",oa="",ia="",ua=z+"xheditor_skin/"+g.skin+"/",Aa=kb,va=g.urlType,E=g.urlBase,W=g.emotPath,W=W?W:z+"xheditor_emot/",Ra="",Aa=e.extend({},Aa,g.emots),W=T(W,"rel",E?E:null);(ma=g.showBlocktag)&&(ia+=" showBlocktag");var la=[];this.init=function(){e("#"+ab).length===0&&e("head").append('<link id="'+ab+'" rel="stylesheet" type="text/css" href="'+ua+'ui.css" />');var a=F.outerWidth(),b=F.outerHeight(),a=g.width||y.style.width||(a>10?a:0);O=g.height||y.style.height||(b>10?b:150);M(a,"number")&&(a+="px");M(O,"string")&&(O=O.replace(/[^\d]+/g,""));var b=g.background||y.style.background,c=['<span class="xheGStart"/>'],f,i,n=/\||\//i;e.each(g.tools,function(a,b){b.match(n)&&c.push('<span class="xheGEnd"/>');if(b==="|")c.push('<span class="xheSeparator"/>');else if(b==="/")c.push("<br />");else{f=ja[b];if(!f)return;i=f.c?f.c:"xheIcon xheBtn"+b;c.push('<span><a href="#" title="'+f.t+'" cmd="'+b+'" class="xheButton xheEnabled" tabindex="-1" role="button"><span class="'+i+'" unselectable="on" style="font-size:0;color:transparent;text-indent:-999px;">'+f.t+"</span></a></span>");f.s&&d.addShortcuts(f.s,b)}b.match(n)&&c.push('<span class="xheGStart"/>')});c.push('<span class="xheGEnd"/><br />');F.after(e('<input type="text" id="'+za+'" style="position:absolute;display:none;" /><span id="'+ha+'" class="xhe_'+g.skin+'" style="display:none"><table cellspacing="0" cellpadding="0" class="xheLayout" style="'+(a!="0px"?"width:"+a+";":"")+"height:"+O+'px;" role="presentation"><tr><td id="'+bb+'" class="xheTool" unselectable="on" style="height:1px;" role="presentation"></td></tr><tr><td id="'+cb+'" class="xheIframeArea" role="presentation"><iframe frameborder="0" id="'+db+'" src="javascript:;" style="width:100%;"></iframe></td></tr></table></span>'));r=e("#"+bb);A=e("#"+cb);oa='<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><link rel="stylesheet" href="'+ua+'iframe.css"/>';if(a=g.loadCSS)if(M(a,"array"))for(var j in a)oa+='<link rel="stylesheet" href="'+a[j]+'"/>';else oa+=a.match(/\s*<style(\s+[^>]*?)?>[\s\S]+?<\/style>\s*/i)?a:'<link rel="stylesheet" href="'+a+'"/>';j="<html><head>"+oa+"<title>\u53ef\u89c6\u5316\u7f16\u8f91\u5668,alt+1\u52309\u952e,\u5207\u6362\u5230\u5de5\u5177\u533a,tab\u952e,\u9009\u62e9\u6309\u94ae,esc\u952e,\u8fd4\u56de\u7f16\u8f91 "+(g.readTip?g.readTip:"")+"</title>";b&&(j+="<style>html{background:"+b+";}</style>");j+='</head><body spellcheck="0" class="editMode'+ia+'"></body></html>';d.win=U=e("#"+db)[0].contentWindow;da=e(U);try{this.doc=l=U.document,ea=e(l),l.open(),l.write(j),l.close(),h?l.body.contentEditable="true":l.designMode="On"}catch(p){}setTimeout(La,300);d.setSource();U.setInterval=null;r.append(c.join("")).bind("mousedown contextmenu",N).click(function(a){var b=e(a.target).closest("a");b.is(".xheEnabled")&&(clearTimeout(wa),r.find("a").attr("tabindex","-1"),u=a,d.exec(b.attr("cmd")));return false});r.find(".xheButton").hover(function(a){var b=e(this),c=g.hoverExecDelay,k=V;V=null;if(c===-1||na||!b.is(".xheEnabled"))return false;if(k&&k>10)return na=true,setTimeout(function(){na=false},100),false;var f=b.attr("cmd");if(ja[f].h!==1)return d.hidePanel(),false;Qa&&(c=0);c>=0&&(wa=setTimeout(function(){u=a;ga={x:u.clientX,y:u.clientY};d.exec(f)},c))},function(){ga=null;wa&&clearTimeout(wa)}).mousemove(function(a){if(ga){var b=a.clientX-ga.x,c=a.clientY-ga.y;if(Math.abs(b)>1||Math.abs(c)>1)b>0&&c>0?(b=Math.round(Math.atan(c/b)/0.017453293),V=V?(V+b)/2:b):V=null,ga={x:a.clientX,y:a.clientY}}});m=e("#xhePanel");$=e("#xheShadow");aa=e("#xheCntLine");m.length===0&&(m=e('<div id="xhePanel"></div>').mousedown(function(a){a.stopPropagation()}),$=e('<div id="xheShadow"></div>'),aa=e('<div id="xheCntLine"></div>'),setTimeout(function(){e(document.body).append(m).append($).append(aa)},10));e("#"+ha).show();F.hide();A.css("height",O-r.outerHeight());h&pa<8&&setTimeout(function(){A.css("height",O-r.outerHeight())},1);F.focus(d.focus);Ya.submit(S).bind("reset",J);g.submitID&&e("#"+g.submitID).mousedown(S);e(window).bind("unload beforeunload",S).bind("resize",Na);e(document).mousedown(Oa);Sa||(e(document).keydown(I),Sa=true);da.focus(function(){g.focus&&g.focus()}).blur(function(){g.blur&&g.blur()});P&&da.click(Da);ea.mousedown(Oa).keydown(ob).keypress(Ba).dblclick(o).bind("mousedown click",function(a){F.trigger(a.type)});if(h){ea.keydown(function(a){var b=d.getRng();if(a.which===8&&b.item)return e(b.item(0)).remove(),false});var v=function(a){var a=e(a.target),b;(b=a.css("width"))&&a.css("width","").attr("width",b.replace(/[^0-9%]+/g,""));(b=a.css("height"))&&a.css("height","").attr("height",b.replace(/[^0-9%]+/g,""))};ea.bind("controlselect",function(a){a=a.target;e.nodeName(a,"IMG")&&e(a).unbind("resizeend",v).bind("resizeend",v)})}ea.keydown(function(a){var b=a.which;if(a.altKey&&b>=49&&b<=57)return r.find("a").attr("tabindex","0"),r.find(".xheGStart").eq(b-49).next().find("a").focus(),l.title="\ufeff\ufeff",false}).click(function(){r.find("a").attr("tabindex","-1")});r.keydown(function(a){var b=a.which;if(b==27)r.find("a").attr("tabindex","-1"),d.focus();else if(a.altKey&&b>=49&&b<=57)return r.find(".xheGStart").eq(b-49).next().find("a").focus(),false});j=e(l.documentElement);Ca?j.bind("keydown",function(a){a.ctrlKey&&a.which===86&&Ua()}):j.bind(h?"beforepaste":"paste",Ua);g.disableContextmenu&&j.bind("contextmenu",N);g.html5Upload&&j.bind("dragenter dragover",function(a){var b;if((b=a.originalEvent.dataTransfer.types)&&e.inArray("Files",b)!==-1)return false}).bind("drop",function(a){var a=a.originalEvent.dataTransfer,b;if(a&&(b=a.files)&&b.length>0){var c,k,a=["Link","Img","Flash","Media"],f=[],j;for(c in a)k=a[c],g["up"+k+"Url"]&&g["up"+k+"Url"].match(/^[^!].*/i)&&f.push(k+":,"+g["up"+k+"Ext"]);if(f.length===0)return false;else j=f.join(",");k=function(a){var b,d;for(c=0;c<a.length;c++)if(b=a[c].name.replace(/.+\./,""),b=j.match(RegExp("(\\w+):[^:]*,"+b+"(?:,|$)","i")))if(d){if(d!==b[1])return 2}else d=b[1];else return 1;return d}(b);k===1?alert("\u4e0a\u4f20\u6587\u4ef6\u7684\u6269\u5c55\u540d\u5fc5\u9700\u4e3a\uff1a"+j.replace(/\w+:,/g,"")):k===2?alert("\u6bcf\u6b21\u53ea\u80fd\u62d6\u653e\u4e0a\u4f20\u540c\u4e00\u7c7b\u578b\u6587\u4ef6"):k&&d.startUpload(b,g["up"+k+"Url"],"*",function(a){var b=[],c;(c=g.onUpload)&&c(a);for(var f=0,j=a.length;f<j;f++)c=a[f],url=M(c,"string")?c:c.url,url.substr(0,1)==="!"&&(url=url.substr(1)),b.push(url);d.exec(k);e("#xhe"+k+"Url").val(b.join(" "));e("#xheSave").click()});return false}});(j=g.shortcuts)&&e.each(j,function(a,b){d.addShortcuts(a,b)});Z++;Ma=true;g.fullscreen?d.toggleFullscreen():g.sourceMode&&setTimeout(d.toggleSource,20);return true};this.remove=function(){d.hidePanel();S();F.unbind("focus",d.focus);Ya.unbind("submit",S).unbind("reset",J);g.submitID&&e("#"+g.submitID).unbind("mousedown",S);e(window).unbind("unload beforeunload",S).unbind("resize",Na);e(document).unbind("mousedown",Oa);e("#"+ha).remove();e("#"+za).remove();F.show();Ma=false};this.saveBookmark=function(){if(!w){d.focus();var a=d.getRng(),a=a.cloneRange?a.cloneRange():a;fa={top:da.scrollTop(),rng:a}}};this.loadBookmark=function(){if(!w&&fa){d.focus();var a=fa.rng;if(h)a.select();else{var b=d.getSel();b.removeAllRanges();b.addRange(a)}da.scrollTop(fa.top);fa=null}};this.focus=function(){w?e("#sourceCode",l).focus():U.focus();if(h){var a=d.getRng();a.parentElement&&a.parentElement().ownerDocument!==l&&d.setTextCursor()}return false};this.setTextCursor=function(a){var b=d.getRng(true),c=l.body;if(h)b.moveToElementText(c);else{for(var e=a?"lastChild":"firstChild";c.nodeType!=3&&c[e];)c=c[e];b.selectNode(c)}b.collapse(a?false:true);h?b.select():(a=d.getSel(),a.removeAllRanges(),a.addRange(b))};this.getSel=function(){return l.selection?l.selection:U.getSelection()};this.getRng=function(a){var b,c;try{a||(b=d.getSel(),c=b.createRange?b.createRange():b.rangeCount>0?b.getRangeAt(0):null),c||(c=l.body.createTextRange?l.body.createTextRange():l.createRange())}catch(e){}return c};this.getParent=function(a){var b=d.getRng(),c;h?c=b.item?b.item(0):b.parentElement():(c=b.commonAncestorContainer,b.collapsed||b.startContainer===b.endContainer&&b.startOffset-b.endOffset<2&&b.startContainer.hasChildNodes()&&(c=b.startContainer.childNodes[b.startOffset]));a=a?a:"*";c=e(c);c.is(a)||(c=e(c).closest(a));return c};this.getSelect=function(a){var b=d.getSel(),c=d.getRng(),f=true,f=!c||c.item?false:!b||c.boundingWidth===0||c.collapsed;if(a==="text")return f?"":c.text||(b.toString?b.toString():"");c.cloneContents?(a=e("<div></div>"),(c=c.cloneContents())&&a.append(c),c=a.html()):c=M(c.item)?c.item(0).outerHTML:M(c.htmlText)?c.htmlText:c.toString();f&&(c="");c=d.processHTML(c,"read");c=d.cleanHTML(c);return c=d.formatXHTML(c)};this.pasteHTML=function(a,b){if(w)return false;d.focus();var a=d.processHTML(a,"write"),c=d.getSel(),f=d.getRng();if(b!==Y){if(f.item){var i=f.item(0),f=d.getRng(true);f.moveToElementText(i);f.select()}f.collapse(b)}a+="<"+(h?"img":"span")+' id="_xhe_temp" width="0" height="0" />';if(f.insertNode){if(e(f.startContainer).closest("style,script").length>0)return false;f.deleteContents();f.insertNode(f.createContextualFragment(a))}else c.type.toLowerCase()==="control"&&(c.clear(),f=d.getRng()),f.pasteHTML(a);var i=e("#_xhe_temp",l),n=i[0];h?(f.moveToElementText(n),f.select()):(f.selectNode(n),c.removeAllRanges(),c.addRange(f));i.remove()};this.pasteText=function(a,b){a||(a="");a=d.domEncode(a);a=a.replace(/\r?\n/g,"<br />");d.pasteHTML(a,b)};this.appendHTML=function(a){if(w)return false;d.focus();a=d.processHTML(a,"write");e(l.body).append(a);d.setTextCursor(true)};this.domEncode=function(a){return a.replace(nb,function(a){return mb[a]})};this.setSource=function(a){fa=null;if(typeof a!=="string"&&a!=="")a=y.value;w?e("#sourceCode",l).val(a):(g.beforeSetSource&&(a=g.beforeSetSource(a)),a=d.cleanHTML(a),a=d.formatXHTML(a),a=d.processHTML(a,"write"),h?(l.body.innerHTML='<img id="_xhe_temp" width="0" height="0" />'+a,e("#_xhe_temp",l).remove()):l.body.innerHTML=a)};this.processHTML=function(a,b){if(b==="write"){a=a.replace(/(<(\/?)(\w+))((?:\s+[\w\-:]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*((\/?)>)/g,function(a,b,c,d,e,f,i){d=d.toLowerCase();qa?d==="strong"?d="b":d==="em"&&(d="i"):P&&(d==="strong"?(d="span",c||(e+=' class="Apple-style-span" style="font-weight: bold;"')):d==="em"?(d="span",c||(e+=' class="Apple-style-span" style="font-style: italic;"')):d==="u"?(d="span",c||(e+=' class="Apple-style-span" style="text-decoration: underline;"')):d==="strike"&&(d="span",c||(e+=' class="Apple-style-span" style="text-decoration: line-through;"')));var k,x="";if(d==="del")d="strike";else if(d==="img")e=e.replace(/\s+emot\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i,function(a,b){k=b.match(/^(["']?)(.*)\1/)[2];k=k.split(",");k[1]||(k[1]=k[0],k[0]="");k[0]==="default"&&(k[0]="");return g.emotMark?a:""});else if(d==="a")!e.match(/ href=[^ ]/i)&&e.match(/ name=[^ ]/i)&&(x+=" xhe-anchor"),i&&(f="></a>");else if(d==="table"&&!c&&(a=e.match(/\s+border\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i),!a||a[1].match(/^(["']?)\s*0\s*\1$/)))x+=" xhe-border";var X,e=e.replace(/\s+([\w\-:]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/g,function(a,b,c){b=b.toLowerCase();c=c.match(/^(["']?)(.*)\1/)[2];aft="";if(h&&b.match(/^(disabled|checked|readonly|selected)$/)&&c.match(/^(false|0)$/i))return"";if(d==="img"&&k&&b==="src")return"";b.match(/^(src|href)$/)&&(aft=" _xhe_"+b+'="'+c+'"',E&&(c=T(c,"abs",E)));x&&b==="class"&&(c+=" "+x,x="");P&&b==="style"&&d==="span"&&c.match(/(^|;)\s*(font-family|font-size|color|background-color)\s*:\s*[^;]+\s*(;|$)/i)&&(X=true);return" "+b+'="'+c+'"'+aft});k&&(a=W+(k[0]?k[0]:"default")+"/"+k[1]+".gif",e+=' src="'+a+'" _xhe_src="'+a+'"');X&&(e+=' class="Apple-style-span"');x&&(e+=' class="'+x+'"');return"<"+c+d+e+f});h&&(a=a.replace(/&apos;/ig,"&#39;"));if(!P)var c=function(a,b,c,d,e,f){var b="",i,k;(i=d.match(/font-family\s*:\s*([^;"]+)/i))&&(b+=' face="'+i[1]+'"');if(i=d.match(/font-size\s*:\s*([^;"]+)/i)){i=i[1].toLowerCase();for(var x=0;x<R.length;x++)if(i===R[x].n||i===R[x].s){k=x+1;break}k&&(b+=' size="'+k+'"',d=d.replace(/(^|;)(\s*font-size\s*:\s*[^;"]+;?)+/ig,"$1"))}if(k=d.match(/(?:^|[\s;])color\s*:\s*([^;"]+)/i)){if(i=k[1].match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i)){k[1]="#";for(x=1;x<=3;x++)k[1]+=("0"+(i[x]-0).toString(16)).slice(-2)}k[1]=k[1].replace(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3");b+=' color="'+k[1]+'"'}d=d.replace(/(^|;)(\s*(font-family|color)\s*:\s*[^;"]+;?)+/ig,"$1");return b!==""?(d&&(b+=' style="'+d+'"'),"<font"+(c?c:"")+b+(e?e:"")+">"+f+"</font>"):a},a=a.replace(/<(span)(\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"( [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,c),a=a.replace(/<(span)(\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"( [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,c),a=a.replace(/<(span)(\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"( [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,c);a=a.replace(/<(td|th)(\s+[^>]*?)?>(\s|&nbsp;)*<\/\1>/ig,"<$1$2>"+(h?"":"<br />")+"</$1>")}else{if(P)for(var d=[{r:/font-weight\s*:\s*bold;?/ig,t:"strong"},{r:/font-style\s*:\s*italic;?/ig,t:"em"},{r:/text-decoration\s*:\s*underline;?/ig,t:"u"},{r:/text-decoration\s*:\s*line-through;?/ig,t:"strike"}],c=function(a,b,c,e,i){for(var a=(c?c:"")+(e?e:""),g=[],C=[],k,c=0;c<d.length;c++)b=d[c].r,k=d[c].t,a=a.replace(b,function(){g.push("<"+k+">");C.push("</"+k+">");return""});a=a.replace(/\s+style\s*=\s*"\s*"/i,"");return(a?"<span"+a+">":"")+g.join("")+i+C.join("")+(a?"</span>":"")},e=0;e<2;e++)a=a.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,c),a=a.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,c),a=a.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,c);a=a.replace(/(<(\w+))((?:\s+[\w\-:]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*(\/?>)/g,function(a,b,c,d,e){var c=c.toLowerCase(),f,d=d.replace(/\s+_xhe_(?:src|href)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i,function(a,b){f=b.match(/^(["']?)(.*)\1/)[2];return""});f&&va&&(f=T(f,va,E));d=d.replace(/\s+([\w\-:]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/g,function(a,b,c){b=b.toLowerCase();c=c.match(/^(["']?)(.*)\1/)[2].replace(/"/g,"'");if(b==="class"){if(c.match(/^["']?(apple|webkit)/i))return"";c=c.replace(/\s?xhe-[a-z]+/ig,"");if(c==="")return""}else if(b.match(/^((_xhe_|_moz_|_webkit_)|jquery\d+)/i))return"";else if(f&&b.match(/^(src|href)$/i))return" "+b+'="'+f+'"';else b==="style"&&(c=c.replace(/(^|;)\s*(font-size)\s*:\s*([a-z-]+)\s*(;|$)/i,function(a,b,c,d,e){for(var f,i=0;i<R.length;i++)if(a=R[i],d===a.n){f=a.s;break}return b+c+":"+f+e}));return" "+b+'="'+c+'"'});c==="img"&&!d.match(/\s+alt\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i)&&(d+=' alt=""');return b+d+e});a=a.replace(/(<(td|th)(?:\s+[^>]*?)?>)\s*([\s\S]*?)(<br(\s*\/)?>)?\s*<\/\2>/ig,function(a,b,c,d){return b+(d?d:"&nbsp;")+"</"+c+">"});a=a.replace(/^\s*(?:<(p|div)(?:\s+[^>]*?)?>)?\s*(<span(?:\s+[^>]*?)?>\s*<\/span>|<br(?:\s+[^>]*?)?>|&nbsp;)*\s*(?:<\/\1>)?\s*$/i,"")}return a=a.replace(/(<pre(?:\s+[^>]*?)?>)([\s\S]+?)(<\/pre>)/gi,function(a,b,c,d){return b+c.replace(/<br\s*\/?>/ig,"\r\n")+d})};this.getSource=function(a){var b,c=g.beforeGetSource;w?(b=e("#sourceCode",l).val(),c||(b=d.formatXHTML(b,false))):(b=d.processHTML(l.body.innerHTML,"read"),b=d.cleanHTML(b),b=d.formatXHTML(b,a),c&&(b=c(b)));return y.value=b};this.cleanWord=function(a){var b=g.cleanPaste;if(b>0&&b<3&&/mso(-|normal)|WordDocument|<table\s+[^>]*?x:str|\s+class\s*=\s*"?xl[67]\d"/i.test(a)){a=a.replace(/<\!--[\s\S]*?--\>|<!(--)?\[[\s\S]+?\](--)?>|<style(\s+[^>]*?)?>[\s\S]*?<\/style>/ig,"");a=a.replace(/\r?\n/ig,"");h?(a=a.replace(/<v:shapetype(\s+[^>]*)?>[\s\S]*<\/v:shapetype>/ig,""),a=a.replace(/<v:shape(\s+[^>]+)?>[\s\S]*?<v:imagedata(\s+[^>]+)?>\s*<\/v:imagedata>[\s\S]*?<\/v:shape>/ig,function(a,b,c){if(a=c.match(/\s+src\s*=\s*("[^"]+"|'[^']+'|[^>\s]+)/i)){a[1].match(/^(["']?)(.*)\1/);c='<img src="'+z+'xheditor_skin/blank.gif" _xhe_temp="true" class="wordImage"';if(a=b.match(/\s+style\s*=\s*("[^"]+"|'[^']+'|[^>\s]+)/i))a=a[1].match(/^(["']?)(.*)\1/)[2],c+=' style="'+a+'"';c+=" />";return c}return""})):a=a.replace(/<img( [^<>]*(v:shapes|msohtmlclip)[^<>]*)\/?>/ig,function(a,b){var c,d='<img src="'+z+'xheditor_skin/blank.gif" _xhe_temp="true" class="wordImage"';(c=b.match(/ width\s*=\s*"([^"]+)"/i))&&(d+=' width="'+c[1]+'"');(c=b.match(/ height\s*=\s*"([^"]+)"/i))&&(d+=' height="'+c[1]+'"');return d+" />"});for(var a=a.replace(/(<(\/?)([\w\-:]+))((?:\s+[\w\-:]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))?)*)\s*(\/?>)/g,function(a,c,d,e,f,g){e=e.toLowerCase();if(e.match(/^(link)$/)&&f.match(/file:\/\//i)||e.match(/:/)||e==="span"&&b===2)return"";d||(f=f.replace(/\s([\w\-:]+)(?:\s*=\s*("[^"]*"|'[^']*'|[^>\s]+))?/ig,function(a,c,d){c=c.toLowerCase();if(/:/.test(c))return"";d=d.match(/^(["']?)(.*)\1/)[2];if(b===1)switch(e){case "p":if(c==="style")return(d=d.replace(/"|&quot;/ig,"'").replace(/\s*([^:]+)\s*:\s*(.*?)(;|$)/ig,function(a,b,c){return/^(text-align)$/i.test(b)?b+":"+c+";":""}).replace(/^\s+|\s+$/g,""))?" "+c+'="'+d+'"':"";break;case "span":if(c==="style")return(d=d.replace(/"|&quot;/ig,"'").replace(/\s*([^:]+)\s*:\s*(.*?)(;|$)/ig,function(a,b,c){return/^(color|background|font-size|font-family)$/i.test(b)?b+":"+c+";":""}).replace(/^\s+|\s+$/g,""))?" "+c+'="'+d+'"':"";break;case "table":if(c.match(/^(cellspacing|cellpadding|border|width)$/i))return a;break;case "td":if(c.match(/^(rowspan|colspan)$/i))return a;if(c==="style")return(d=d.replace(/"|&quot;/ig,"'").replace(/\s*([^:]+)\s*:\s*(.*?)(;|$)/ig,function(a,b,c){return/^(width|height)$/i.test(b)?b+":"+c+";":""}).replace(/^\s+|\s+$/g,""))?" "+c+'="'+d+'"':"";break;case "a":if(c.match(/^(href)$/i))return a;break;case "font":case "img":return a}else if(b===2)switch(e){case "td":if(c.match(/^(rowspan|colspan)$/i))return a;break;case "img":return a}return""}));return c+f+g}),c=0;c<3;c++)a=a.replace(/<([^\s>]+)(\s+[^>]*)?>\s*<\/\1>/g,"");for(var d=function(a,b,c){return c},c=0;c<3;c++)a=a.replace(/<(span|a)>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,d);for(c=0;c<3;c++)a=a.replace(/<(span|a)>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,d);for(c=0;c<3;c++)a=a.replace(/<(span|a)>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,d);for(c=0;c<3;c++)a=a.replace(/<font(\s+[^>]+)><font(\s+[^>]+)>/ig,function(a,b,c){return"<font"+b+c+">"});a=a.replace(/(<(\/?)(tr|td)(?:\s+[^>]+)?>)[^<>]+/ig,function(a,b,c,d){return!c&&/^td$/i.test(d)?a:b})}return a};this.cleanHTML=function(a){var a=a.replace(/<!?\/?(DOCTYPE|html|body|meta)(\s+[^>]*?)?>/ig,""),b,a=a.replace(/<head(?:\s+[^>]*?)?>([\s\S]*?)<\/head>/i,function(a,d){b=d.match(/<(script|style)(\s+[^>]*?)?>[\s\S]*?<\/\1>/ig);return""});b&&(a=b.join("")+a);a=a.replace(/<\??xml(:\w+)?(\s+[^>]*?)?>([\s\S]*?<\/xml>)?/ig,"");g.internalScript||(a=a.replace(/<script(\s+[^>]*?)?>[\s\S]*?<\/script>/ig,""));g.internalStyle||(a=a.replace(/<style(\s+[^>]*?)?>[\s\S]*?<\/style>/ig,""));if(!g.linkTag||!g.inlineScript||!g.inlineStyle)a=a.replace(/(<(\w+))((?:\s+[\w-]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*(\/?>)/ig,function(a,b,d,e,j){if(!g.linkTag&&d.toLowerCase()==="link")return"";g.inlineScript||(e=e.replace(/\s+on(?:click|dblclick|mouse(down|up|move|over|out|enter|leave|wheel)|key(down|press|up)|change|select|submit|reset|blur|focus|load|unload)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/ig,""));g.inlineStyle||(e=e.replace(/\s+(style|class)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/ig,""));return b+e+j});return a=a.replace(/<\/(strong|b|u|strike|em|i)>((?:\s|<br\/?>|&nbsp;)*?)<\1(\s+[^>]*?)?>/ig,"$2")};this.formatXHTML=function(a,b){function c(a){for(var b={},a=a.split(","),c=0;c<a.length;c++)b[a[c]]=true;return b}function e(a){var a=a.toLowerCase(),b=t[a];return b?b:a}function i(a,b,c){if(k[a])for(;D.last()&&x[D.last()];)g(D.last());X[a]&&D.last()===a&&g(a);(c=C[a]||!!c)||D.push(a);var d=[];d.push("<"+a);b.replace(w,function(a,b,c,e,f){b=b.toLowerCase();d.push(" "+b+'="'+(c?c:e?e:f?f:l[b]?b:"").replace(/"/g,"'")+'"')});d.push((c?" /":"")+">");v(d.join(""),a,true);a==="pre"&&(A=true)}function g(a){if(a)for(b=D.length-1;b>=0;b--){if(D[b]===a)break}else var b=0;if(b>=0){for(var c=D.length-1;c>=b;c--)v("</"+D[c]+">",D[c]);D.length=b}a==="pre"&&(A=false,u--)}function j(a){v(d.domEncode(a))}function p(a){G.push(a.replace(/^[\s\r\n]+|[\s\r\n]+$/g,""))}function v(a,c,d){A||(a=a.replace(/(\t*\r?\n\t*)+/g,""));if(!A&&b===true)if(a.match(/^\s*$/))G.push(a);else{var e=k[c];e?(d&&u++,z===""&&u--):z&&u++;((e?c:"")!==z||e)&&s();G.push(a);c==="br"&&s();e&&(C[c]||!d)&&u--;z=e?c:""}else G.push(a)}function s(){G.push("\r\n");if(u>0)for(var a=u;a--;)G.push("\t")}function q(a,b,c,d){if(!c)return d;var e="",c=c.replace(/ face\s*=\s*"\s*([^"]*)\s*"/i,function(a,b){b&&(e+="font-family:"+b+";");return""}),c=c.replace(/ size\s*=\s*"\s*(\d+)\s*"/i,function(a,b){e+="font-size:"+R[(b>7?7:b<1?1:b)-1].s+";";return""}),c=c.replace(/ color\s*=\s*"\s*([^"]*)\s*"/i,function(a,b){b&&(e+="color:"+b+";");return""}),c=c.replace(/ style\s*=\s*"\s*([^"]*)\s*"/i,function(a,b){b&&(e+=b);return""});c+=' style="'+e+'"';return c?"<span"+c+">"+d+"</span>":d}var C=c("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),k=c("address,applet,blockquote,button,center,dd,dir,div,dl,dt,fieldset,form,frameset,h1,h2,h3,h4,h5,h6,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,table,tbody,td,tfoot,th,thead,tr,ul,script"),x=c("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),X=c("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),l=c("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),h=c("script,style"),t={b:"strong",i:"em",s:"del",strike:"del"},r=/<(?:\/([^\s>]+)|!([^>]*?)|([\w\-:]+)((?:"[^"]*"|'[^']*'|[^"'<>])*)\s*(\/?))>/g,w=/\s*([\w\-:]+)(?:\s*=\s*(?:"([^"]*)"|'([^']*)'|([^\s]+)))?/g,G=[],D=[];D.last=function(){return this[this.length-1]};for(var H,B,o=0,m,y,u=-1,z="body",A=false;H=r.exec(a);){B=H.index;B>o&&(o=a.substring(o,B),m?y.push(o):j(o));o=r.lastIndex;if(B=H[1])if(B=e(B),m&&B===m&&(p(y.join("")),y=m=null),!m){g(B);continue}m?y.push(H[0]):(B=H[3])?(B=e(B),i(B,H[4],H[5]),h[B]&&(m=B,y=[])):H[2]&&G.push(H[0])}a.length>o&&j(a.substring(o,a.length));g();a=G.join("");G=null;a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,q);a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,q);a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,q);return a=a.replace(/^(\s*\r?\n)+|(\s*\r?\n)+$/g,"")};this.toggleShowBlocktag=function(a){ma!==a&&(ma=!ma,a=e(l.body),ma?(ia+=" showBlocktag",a.addClass("showBlocktag")):(ia=ia.replace(" showBlocktag",""),a.removeClass("showBlocktag")))};this.toggleSource=function(a){if(w!==a){r.find("[cmd=Source]").toggleClass("xheEnabled").toggleClass("xheActive");var b=l.body,c=e(b),f,i,a=0,g="";if(w)f=d.getSource(),c.html("").removeAttr("scroll").attr("class","editMode"+ia),h?b.contentEditable="true":l.designMode="On",qa&&(d._exec("inserthtml","-"),e("#"+za).show().focus().hide()),g="\u6e90\u4ee3\u7801";else{d.pasteHTML('<span id="_xhe_cursor"></span>',true);f=d.getSource(true);a=f.indexOf('<span id="_xhe_cursor"></span>');if(!Ca)a=f.substring(0,a).replace(/\r/g,"").length;f=f.replace(/(\r?\n\s*|)<span id="_xhe_cursor"><\/span>(\s*\r?\n|)/,function(a,b,c){return b&&c?"\r\n":b+c});h?b.contentEditable="false":l.designMode="Off";c.attr("scroll","no").attr("class","sourceMode").html('<textarea id="sourceCode" wrap="soft" spellcheck="false" style="width:100%;height:100%" />');i=e("#sourceCode",c).blur(d.getSource)[0];g="\u53ef\u89c6\u5316\u7f16\u8f91"}w=!w;d.setSource(f);d.focus();w?i.setSelectionRange?i.setSelectionRange(a,a):(i=i.createTextRange(),i.move("character",a),i.select()):d.setTextCursor();r.find("[cmd=Source]").attr("title",g).find("span").text(g);r.find("[cmd=Source],[cmd=Preview]").toggleClass("xheEnabled");r.find(".xheButton").not("[cmd=Source],[cmd=Fullscreen],[cmd=About]").toggleClass("xheEnabled").attr("aria-disabled",w?true:false);setTimeout(La,300)}};this.showPreview=function(){var a=g.beforeSetSource,b=d.getSource();a&&(b=a(b));var a="<html><head>"+oa+"<title>\u9884\u89c8</title>"+(E?'<base href="'+E+'"/>':"")+"</head><body>"+b+"</body></html>",b=window.screen,b=window.open("","xhePreview","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+Math.round(b.width*0.9)+",height="+Math.round(b.height*0.8)+",left="+Math.round(b.width*0.05)),c=b.document;c.open();c.write(a);c.close();b.focus()};this.toggleFullscreen=function(a){if(ka!==a){var a=e("#"+ha).find(".xheLayout"),b=e("#"+ha),c=jQuery.browser.version,c=h&&(c==6||c==7);ka?(c&&F.after(b),a.attr("style",Za),A.height(O-r.outerHeight()),e(window).scrollTop(Pa),setTimeout(function(){e(window).scrollTop(Pa)},10)):(c&&e("body").append(b),Pa=e(window).scrollTop(),Za=a.attr("style"),a.removeAttr("style"),A.height("100%"),setTimeout(Na,100));qa?(e("#"+za).show().focus().hide(),setTimeout(d.focus,1)):c&&d.setTextCursor();ka=!ka;b.toggleClass("xhe_Fullscreen");e("html").toggleClass("xhe_Fullfix");r.find("[cmd=Fullscreen]").toggleClass("xheActive");setTimeout(La,300)}};this.showMenu=function(a,b){var c=e('<div class="xheMenu"></div>'),f=a.length,i=[];e.each(a,function(a,b){b.s==="-"?i.push('<div class="xheMenuSeparator"></div>'):i.push("<a href=\"javascript:void('"+b.v+'\')" title="'+(b.t?b.t:b.s)+'" v="'+b.v+'" role="option" aria-setsize="'+f+'" aria-posinset="'+(a+1)+'" tabindex="0">'+b.s+"</a>")});c.append(i.join(""));c.click(function(a){a=a.target;if(!e.nodeName(a,"DIV"))return d.loadBookmark(),b(e(a).closest("a").attr("v")),d.hidePanel(),false}).mousedown(N);d.saveBookmark();d.showPanel(c)};this.showColor=function(a){var b=e('<div class="xheColor"></div>'),c=[],f=Ta.length,i=0;e.each(Ta,function(a,b){i%7===0&&c.push((i>0?"</div>":"")+"<div>");c.push("<a href=\"javascript:void('"+b+'\')" xhev="'+b+'" title="'+b+'" style="background:'+b+'" role="option" aria-setsize="'+f+'" aria-posinset="'+(i+1)+'"></a>');i++});c.push("</div>");b.append(c.join(""));b.click(function(b){b=b.target;if(e.nodeName(b,"A"))return d.loadBookmark(),a(e(b).attr("xhev")),d.hidePanel(),false}).mousedown(N);d.saveBookmark();d.showPanel(b)};this.showPastetext=function(){var a=e('<div><label for="xhePastetextValue">\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl+V)\u628a\u5185\u5bb9\u7c98\u8d34\u5230\u65b9\u6846\u91cc\uff0c\u6309 \u786e\u5b9a</label></div><div><textarea id="xhePastetextValue" wrap="soft" spellcheck="false" style="width:300px;height:100px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>'),b=e("#xhePastetextValue",a);e("#xheSave",a).click(function(){d.loadBookmark();var a=b.val();a&&d.pasteText(a);d.hidePanel();return false});d.saveBookmark();d.showDialog(a)};this.showLink=function(){var a='<div><label for="xheLinkUrl">\u94fe\u63a5\u5730\u5740: </label><input type="text" id="xheLinkUrl" value="http://" class="xheText" /></div><div><label for="xheLinkTarget">\u6253\u5f00\u65b9\u5f0f: </label><select id="xheLinkTarget"><option selected="selected" value="">\u9ed8\u8ba4</option><option value="_blank">\u65b0\u7a97\u53e3</option><option value="_self">\u5f53\u524d\u7a97\u53e3</option><option value="_parent">\u7236\u7a97\u53e3</option></select></div><div style="display:none"><label for="xheLinkText">\u94fe\u63a5\u6587\u5b57: </label><input type="text" id="xheLinkText" value="" class="xheText" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>',b=ea.find("a[name]").not("[href]"),c=b.length>0;if(c){var f=[];b.each(function(){var a=e(this).attr("name");f.push('<option value="#'+a+'">'+a+"</option>")});a=a.replace(/(<div><label for="xheLinkTarget)/,'<div><label for="xheLinkAnchor">\u9875\u5185\u951a\u70b9: </label><select id="xheLinkAnchor"><option value="">\u672a\u9009\u62e9</option>'+f.join("")+"</select></div>$1")}var a=e(a),i=d.getParent("a"),n=e("#xheLinkText",a),j=e("#xheLinkUrl",a),p=e("#xheLinkTarget",a),b=e("#xheSave",a),v=d.getSelect();c&&a.find("#xheLinkAnchor").change(function(){var a=e(this).val();a!=""&&j.val(a)});if(i.length===1){if(!i.attr("href"))return u=null,d.exec("Anchor");j.val(L(i,"href"));p.attr("value",i.attr("target"))}else v===""&&n.val(g.defLinkText).closest("div").show();g.upLinkUrl&&d.uploadInit(j,g.upLinkUrl,g.upLinkExt);b.click(function(){d.loadBookmark();var a=j.val();(a===""||i.length===0)&&d._exec("unlink");if(a!==""&&a!=="http://"){var b=a.split(" "),c=p.val(),f=n.val();if(b.length>1){d._exec("unlink");v=d.getSelect();var g='<a href="xhe_tmpurl"',X=[];c!==""&&(g+=' target="'+c+'"');g+=">xhe_tmptext</a>";for(var f=v!==""?v:f?f:a,h=0,pb=b.length;h<pb;h++)a=b[h],a!==""&&(a=a.split("||"),c=g,c=c.replace("xhe_tmpurl",a[0]),c=c.replace("xhe_tmptext",a[1]?a[1]:f),X.push(c));d.pasteHTML(X.join("&nbsp;"))}else a=b[0].split("||"),f||(f=a[0]),f=a[1]?a[1]:v!==""?"":f?f:a[0],i.length===0?(f?d.pasteHTML('<a href="#xhe_tmpurl">'+f+"</a>"):d._exec("createlink","#xhe_tmpurl"),i=e('a[href$="#xhe_tmpurl"]',l)):f&&!P&&i.text(f),L(i,"href",a[0]),c!==""?i.attr("target",c):i.removeAttr("target")}d.hidePanel();return false});d.saveBookmark();d.showDialog(a)};this.showAnchor=function(){var a=e('<div><label for="xheAnchorName">\u951a\u70b9\u540d\u79f0: </label><input type="text" id="xheAnchorName" value="" class="xheText" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>'),b=d.getParent("a"),c=e("#xheAnchorName",a),f=e("#xheSave",a);if(b.length===1){if(b.attr("href"))return u=null,d.exec("Link");c.val(b.attr("name"))}f.click(function(){d.loadBookmark();var a=c.val();a?b.length===0?d.pasteHTML('<a name="'+a+'"></a>'):b.attr("name",a):b.length===1&&b.remove();d.hidePanel();return false});d.saveBookmark();d.showDialog(a)};this.showImg=function(){var a=e('<div><label for="xheImgUrl">\u56fe\u7247\u6587\u4ef6: </label><input type="text" id="xheImgUrl" value="http://" class="xheText" /></div><div><div><label for="xheImgAlt">\u66ff\u6362\u6587\u672c: </label><input type="text" id="xheImgAlt" /></div><div><label for="xheImgAlign">\u5bf9\u9f50\u65b9\u5f0f: </label><select id="xheImgAlign"><option selected="selected" value="">\u9ed8\u8ba4</option><option value="left">\u5de6\u5bf9\u9f50</option><option value="right">\u53f3\u5bf9\u9f50</option><option value="top">\u9876\u7aef</option><option value="middle">\u5c45\u4e2d</option><option value="baseline">\u57fa\u7ebf</option><option value="bottom">\u5e95\u8fb9</option></select></div><div><label for="xheImgWidth">\u5bbd\u3000\u3000\u5ea6: </label><input type="text" id="xheImgWidth" style="width:40px;" /> <label for="xheImgHeight">\u9ad8\u3000\u3000\u5ea6: </label><input type="text" id="xheImgHeight" style="width:40px;" /></div><div><label for="xheImgBorder">\u8fb9\u6846\u5927\u5c0f: </label><input type="text" id="xheImgBorder" style="width:40px;" /></div><div><label for="xheImgHspace">\u6c34\u5e73\u95f4\u8ddd: </label><input type="text" id="xheImgHspace" style="width:40px;" /> <label for="xheImgVspace">\u5782\u76f4\u95f4\u8ddd: </label><input type="text" id="xheImgVspace" style="width:40px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>'),b=d.getParent("img"),c=e("#xheImgUrl",a),f=e("#xheImgAlt",a),i=e("#xheImgAlign",a),n=e("#xheImgWidth",a),j=e("#xheImgHeight",a),p=e("#xheImgBorder",a),v=e("#xheImgVspace",a),s=e("#xheImgHspace",a),q=e("#xheSave",a);if(b.length===1){c.val(L(b,"src"));f.val(b.attr("alt"));i.val(b.attr("align"));n.val(b.attr("width"));j.val(b.attr("height"));p.val(b.attr("border"));var C=b.attr("vspace"),k=b.attr("hspace");v.val(C<=0?"":C);s.val(k<=0?"":k)}g.upImgUrl&&d.uploadInit(c,g.upImgUrl,g.upImgExt);q.click(function(){d.loadBookmark();var a=c.val();if(a!==""&&a!=="http://"){var g=a.split(" "),k=f.val(),C=i.val(),q=n.val(),h=j.val(),t=p.val(),o=v.val(),r=s.val();if(g.length>1){var m='<img src="xhe_tmpurl"',u=[];k!==""&&(m+=' alt="'+k+'"');C!==""&&(m+=' align="'+C+'"');q!==""&&(m+=' width="'+q+'"');h!==""&&(m+=' height="'+h+'"');t!==""&&(m+=' border="'+t+'"');o!==""&&(m+=' vspace="'+o+'"');r!==""&&(m+=' hspace="'+r+'"');m+=" />";for(var y in g)a=g[y],a!==""&&(a=a.split("||"),k=m,k=k.replace("xhe_tmpurl",a[0]),a[1]&&(k='<a href="'+a[1]+'" target="_blank">'+k+"</a>"),u.push(k));d.pasteHTML(u.join("&nbsp;"))}else g.length===1&&(a=g[0],a!==""&&(a=a.split("||"),b.length===0&&(d.pasteHTML('<img src="'+a[0]+'#xhe_tmpurl" />'),b=e('img[src$="#xhe_tmpurl"]',l)),L(b,"src",a[0]),k!==""&&b.attr("alt",k),C!==""?b.attr("align",C):b.removeAttr("align"),q!==""?b.attr("width",q):b.removeAttr("width"),h!==""?b.attr("height",h):b.removeAttr("height"),t!==""?b.attr("border",t):b.removeAttr("border"),o!==""?b.attr("vspace",o):b.removeAttr("vspace"),r!==""?b.attr("hspace",r):b.removeAttr("hspace"),a[1]&&(g=b.parent("a"),g.length===0&&(b.wrap("<a></a>"),g=b.parent("a")),L(g,"href",a[1]),g.attr("target","_blank"))))}else b.length===1&&b.remove();d.hidePanel();return false});d.saveBookmark();d.showDialog(a)};this.showEmbed=function(a,b,c,f,g,n,j){var b=e(b),p=d.getParent('embed[type="'+c+'"],embed[classid="'+f+'"]'),v=e("#xhe"+a+"Url",b),s=e("#xhe"+a+"Width",b),q=e("#xhe"+a+"Height",b),a=e("#xheSave",b);n&&d.uploadInit(v,n,j);p.length===1&&(v.val(L(p,"src")),s.val(p.attr("width")),q.val(p.attr("height")));a.click(function(){d.loadBookmark();var a=v.val();if(a!==""&&a!=="http://"){var b=s.val(),j=q.val(),n=/^\d+%?$/;n.test(b)||(b=412);n.test(j)||(j=300);var h='<embed type="'+c+'" classid="'+f+'" src="xhe_tmpurl"'+g,n=a.split(" ");if(n.length>1){h+="";var m,t=[];h+=' width="xhe_width" height="xhe_height" />';for(var o in n)a=n[o].split("||"),m=h,m=m.replace("xhe_tmpurl",a[0]),m=m.replace("xhe_width",a[1]?a[1]:b),m=m.replace("xhe_height",a[2]?a[2]:j),a!==""&&t.push(m);d.pasteHTML(t.join("&nbsp;"))}else n.length===1&&(a=n[0].split("||"),p.length===0&&(d.pasteHTML(h.replace("xhe_tmpurl",a[0]+"#xhe_tmpurl")+" />"),p=e('embed[src$="#xhe_tmpurl"]',l)),L(p,"src",a[0]),p.attr("width",a[1]?a[1]:b),p.attr("height",a[2]?a[2]:j))}else p.length===1&&p.remove();d.hidePanel();return false});d.saveBookmark();d.showDialog(b)};this.showEmot=function(a){var b=e('<div class="xheEmot"></div>'),a=a?a:Ra?Ra:"default",c=Aa[a],f=W+a+"/",g=0,n=[],j="",j=c.width,p=c.height,v=c.line,s=c.count,c=c.list;if(s)for(c=1;c<=s;c++)g++,n.push("<a href=\"javascript:void('"+c+'\')" style="background-image:url('+f+c+'.gif);" emot="'+a+","+c+'" xhev="" title="'+c+'" role="option">&nbsp;</a>'),g%v===0&&n.push("<br />");else e.each(c,function(b,c){g++;n.push("<a href=\"javascript:void('"+c+'\')" style="background-image:url('+f+b+'.gif);" emot="'+a+","+b+'" title="'+c+'" xhev="'+c+'" role="option">&nbsp;</a>');g%v===0&&n.push("<br />")});var s=v*(j+12),c=Math.ceil(g/v)*(p+12),q=s*0.75;c<=q&&(q="");j=e("<style>"+(q?".xheEmot div{width:"+(s+20)+"px;height:"+q+"px;}":"")+".xheEmot div a{width:"+j+"px;height:"+p+"px;}</style><div>"+n.join("")+"</div>").click(function(a){var a=a.target,b=e(a);if(e.nodeName(a,"A"))return d.loadBookmark(),d.pasteHTML('<img emot="'+b.attr("emot")+'" alt="'+b.attr("xhev")+'">'),d.hidePanel(),false}).mousedown(N);b.append(j);var h=0,k=['<ul role="tablist">'];e.each(Aa,function(b,c){h++;k.push("<li"+(a===b?' class="cur"':"")+' role="presentation"><a href="javascript:void(\''+c.name+'\')" group="'+b+'" role="tab" tabindex="0">'+c.name+"</a></li>")});h>1&&(k.push('</ul><br style="clear:both;" />'),j=e(k.join("")).click(function(a){Ra=e(a.target).attr("group");d.exec("Emot");return false}).mousedown(N),b.append(j));d.saveBookmark();d.showPanel(b)};this.showTable=function(){var a=e('<div><label for="xheTableRows">\u884c\u3000\u3000\u6570: </label><input type="text" id="xheTableRows" style="width:40px;" value="3" /> <label for="xheTableColumns">\u5217\u3000\u3000\u6570: </label><input type="text" id="xheTableColumns" style="width:40px;" value="2" /></div><div><label for="xheTableHeaders">\u6807\u9898\u5355\u5143: </label><select id="xheTableHeaders"><option selected="selected" value="">\u65e0</option><option value="row">\u7b2c\u4e00\u884c</option><option value="col">\u7b2c\u4e00\u5217</option><option value="both">\u7b2c\u4e00\u884c\u548c\u7b2c\u4e00\u5217</option></select></div><div><label for="xheTableWidth">\u5bbd\u3000\u3000\u5ea6: </label><input type="text" id="xheTableWidth" style="width:40px;" value="200" /> <label for="xheTableHeight">\u9ad8\u3000\u3000\u5ea6: </label><input type="text" id="xheTableHeight" style="width:40px;" value="" /></div><div><label for="xheTableBorder">\u8fb9\u6846\u5927\u5c0f: </label><input type="text" id="xheTableBorder" style="width:40px;" value="1" /></div><div><label for="xheTableCellSpacing">\u8868\u683c\u95f4\u8ddd: </label><input type="text" id="xheTableCellSpacing" style="width:40px;" value="1" /> <label for="xheTableCellPadding">\u8868\u683c\u586b\u5145: </label><input type="text" id="xheTableCellPadding" style="width:40px;" value="1" /></div><div><label for="xheTableAlign">\u5bf9\u9f50\u65b9\u5f0f: </label><select id="xheTableAlign"><option selected="selected" value="">\u9ed8\u8ba4</option><option value="left">\u5de6\u5bf9\u9f50</option><option value="center">\u5c45\u4e2d</option><option value="right">\u53f3\u5bf9\u9f50</option></select></div><div><label for="xheTableCaption">\u8868\u683c\u6807\u9898: </label><input type="text" id="xheTableCaption" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>'),b=e("#xheTableRows",a),c=e("#xheTableColumns",a),f=e("#xheTableHeaders",a),g=e("#xheTableWidth",a),n=e("#xheTableHeight",a),j=e("#xheTableBorder",a),p=e("#xheTableCellSpacing",a),h=e("#xheTableCellPadding",a),s=e("#xheTableAlign",a),q=e("#xheTableCaption",a);e("#xheSave",a).click(function(){d.loadBookmark();var a=q.val(),e=j.val(),l=b.val(),m=c.val(),t=f.val(),o=g.val(),r=n.val(),u=p.val(),y=h.val(),w=s.val(),e="<table"+(e!==""?' border="'+e+'"':"")+(o!==""?' width="'+o+'"':"")+(r!==""?' height="'+r+'"':"")+(u!==""?' cellspacing="'+u+'"':"")+(y!==""?' cellpadding="'+y+'"':"")+(w!==""?' align="'+w+'"':"")+">";a!==""&&(e+="<caption>"+a+"</caption>");if(t==="row"||t==="both"){e+="<tr>";for(a=0;a<m;a++)e+='<th scope="col"></th>';e+="</tr>";l--}e+="<tbody>";for(a=0;a<l;a++){e+="<tr>";for(o=0;o<m;o++)e+=o===0&&(t==="col"||t==="both")?'<th scope="row"></th>':"<td></td>";e+="</tr>"}e+="</tbody></table>";d.pasteHTML(e);d.hidePanel();return false});d.saveBookmark();d.showDialog(a)};this.showAbout=function(){var a=e('<div style="font:12px Arial;width:245px;word-wrap:break-word;word-break:break-all;outline:none;" role="dialog" tabindex="-1"><p><span style="font-size:20px;color:#1997DF;">xhEditor</span><br />v1.1.14 (build 120701)</p><p>xhEditor\u662f\u57fa\u4e8ejQuery\u5f00\u53d1\u7684\u8de8\u5e73\u53f0\u8f7b\u91cf\u53ef\u89c6\u5316XHTML\u7f16\u8f91\u5668\uff0c\u57fa\u4e8e<a href="http://www.gnu.org/licenses/lgpl.html" target="_blank">LGPL</a>\u5f00\u6e90\u534f\u8bae\u53d1\u5e03\u3002</p><p>Copyright &copy; <a href="http://xheditor.com/" target="_blank">xhEditor.com</a>. All rights reserved.</p></div>');a.find("p").attr("role","presentation");d.showDialog(a,true);setTimeout(function(){a.focus()},100)};this.addShortcuts=function(a,b){a=a.toLowerCase();la[a]===Y&&(la[a]=[]);la[a].push(b)};this.delShortcuts=function(a){delete la[a]};this.uploadInit=function(a,b,c){function f(b){M(b,"string")&&(b=[b]);var c=false,d,e=b.length,f,i=[];(d=g.onUpload)&&d(b);for(d=0;d<e;d++)f=b[d],f=M(f,"string")?f:f.url,f.substr(0,1)==="!"&&(c=true,f=f.substr(1)),i.push(f);a.val(i.join(" "));c&&a.closest(".xheDialog").find("#xheSave").click()}var i=e('<span class="xheUpload"><input type="text" style="visibility:hidden;" tabindex="-1" /><input type="button" value="'+g.upBtnText+'" class="xheBtn" tabindex="-1" /></span>'),n=e(".xheBtn",i),j=g.html5Upload,p=j?g.upMultiple:1;a.after(i);n.before(a);b=b.replace(/{editorRoot}/ig,z);if(b.substr(0,1)==="!")n.click(function(){d.showIframeModal("\u4e0a\u4f20\u6587\u4ef6",b.substr(1),f,null,null)});else{i.append('<input type="file"'+(p>1?' multiple=""':"")+' class="xheFile" size="13" name="filedata" tabindex="-1" />');var h=e(".xheFile",i);h.change(function(){d.startUpload(h[0],b,c,f)});setTimeout(function(){a.closest(".xheDialog").bind("dragenter dragover",N).bind("drop",function(a){var a=a.originalEvent.dataTransfer,e;j&&a&&(e=a.files)&&e.length>0&&d.startUpload(e,b,c,f);return false})},10)}};this.startUpload=function(a,b,c,f){function i(a,c){var e=Object,g=false;try{e=eval("("+a+")")}catch(i){}e.err===Y||e.msg===Y?alert(b+" \u4e0a\u4f20\u63a5\u53e3\u53d1\u751f\u9519\u8bef\uff01\r\n\r\n\u8fd4\u56de\u7684\u9519\u8bef\u5185\u5bb9\u4e3a: \r\n\r\n"+a):e.err?alert(e.err):(n.push(e.msg),g=true);(!g||c)&&d.removeModal();c&&g&&f(n);return g}var n=[],j=g.html5Upload,p=j?g.upMultiple:1,h,s=e('<div style="padding:22px 0;text-align:center;line-height:30px;">\u6587\u4ef6\u4e0a\u4f20\u4e2d\uff0c\u8bf7\u7a0d\u5019\u2026\u2026<br /></div>'),q='<img src="'+ua+'img/loading.gif">';if(Ca||!j||a.nodeType&&(!(h=a.files)||!h[0].name)){if(!Wa(a.value,c))return;s.append(q);c=new d.html4Upload(a,b,i)}else{h||(h=a);a=h.length;if(a>p){alert("\u8bf7\u4e0d\u8981\u4e00\u6b21\u4e0a\u4f20\u8d85\u8fc7"+p+"\u4e2a\u6587\u4ef6");return}for(p=0;p<a;p++)if(!Wa(h[p].name,c))return;var l=e('<div class="xheProgress"><div><span>0%</span></div></div>');s.append(l);c=new d.html5Upload("filedata",h,b,i,function(a){if(a.loaded>=0){var b=Math.round(a.loaded*100/a.total)+"%";e("div",l).css("width",b);e("span",l).text(b+" ( "+Xa(a.loaded)+" / "+Xa(a.total)+" )")}else l.replaceWith(q)})}d.showModal("\u6587\u4ef6\u4e0a\u4f20\u4e2d(Esc\u53d6\u6d88\u4e0a\u4f20)",s,320,150);c.start()};this.html4Upload=function(a,b,c){var d="jUploadFrame"+(new Date).getTime(),g=this,h=e('<iframe name="'+d+'" class="xheHideArea" />').appendTo("body"),j=e('<form action="'+b+'" target="'+d+'" method="post" enctype="multipart/form-data" class="xheHideArea"></form>').appendTo("body"),p=e(a),l=p.clone().attr("disabled","true");p.before(l).appendTo(j);this.remove=function(){g!==null&&(l.before(p).remove(),h.remove(),j.remove(),g=null)};this.onLoad=function(){var a=h[0].contentWindow.document,b=e(a.body).text();a.write("");g.remove();c(b,true)};this.start=function(){j.submit();h.load(g.onLoad)};return this};this.html5Upload=function(a,b,c,d,e){function g(b,c,d,e){h=new XMLHttpRequest;upload=h.upload;h.onreadystatechange=function(){h.readyState===4&&d(h.responseText)};upload?upload.onprogress=function(a){e(a.loaded)}:e(-1);h.open("POST",c);h.setRequestHeader("x-requested-with","XMLHttpRequest");h.setRequestHeader("x-file-name",encodeURIComponent(b.fileName));h.setRequestHeader("Content-Type","application/octet-stream");h.setRequestHeader("Content-Disposition",'attachment; name="'+encodeURIComponent(a)+'"; filename="'+encodeURIComponent(b.name)+'"');h.sendAsBinary&&b.getAsBinary?h.sendAsBinary(b.getAsBinary()):h.send(b)}function j(a){e&&e({loaded:q+a,total:m})}for(var h,l=0,s=b.length,q=0,m=0,k=this,o=0;o<s;o++)m+=b[o].size;this.remove=function(){h&&(h.abort(),h=null)};this.uploadNext=function(a){a&&(q+=b[l-1].size,j(0));(!a||a&&d(a,l===s)===true)&&l<s&&g(b[l++],c,k.uploadNext,function(a){j(a)})};this.start=function(){k.uploadNext()}};this.showIframeModal=function(a,b,c,f,g,h){function j(){try{q.callback=l,q.unloadme=d.removeModal,e(q.document).keydown(I),o=q.name}catch(a){}}function l(a){q.document.write("");d.removeModal();a!=null&&c(a)}var b=e('<iframe frameborder="0" src="'+b.replace(/{editorRoot}/ig,z)+(/\?/.test(b)?"&":"?")+"parenthost="+location.host+'" style="width:100%;height:100%;display:none;" /><div class="xheModalIfmWait"></div>'),m=b.eq(0),s=b.eq(1);d.showModal(a,b,f,g,h);var q=m[0].contentWindow,o;j();m.load(function(){j();if(o){var a=true;try{o=eval("("+unescape(o)+")")}catch(b){a=false}if(a)return l(o)}s.is(":visible")&&(m.show().focus(),s.remove())})};this.showModal=function(a,b,c,f,i){if(ta)return false;d.panelState=Q;Q=false;ca=g.layerShadow;c=c?c:g.modalWidth;f=f?f:g.modalHeight;K=e('<div class="xheModal" style="width:'+(c-1)+"px;height:"+f+"px;margin-left:-"+Math.ceil(c/2)+"px;"+(h&&pa<7?"":"margin-top:-"+Math.ceil(f/2)+"px")+'">'+(g.modalTitle?'<div class="xheModalTitle"><span class="xheModalClose" title="\u5173\u95ed (Esc)" tabindex="0" role="button"></span>'+a+"</div>":"")+'<div class="xheModalContent"></div></div>').appendTo("body");Fa=e('<div class="xheModalOverlay"></div>').appendTo("body");ca>0&&(Ea=e('<div class="xheModalShadow" style="width:'+K.outerWidth()+"px;height:"+K.outerHeight()+"px;margin-left:-"+(Math.ceil(c/2)-ca-2)+"px;"+(h&&pa<7?"":"margin-top:-"+(Math.ceil(f/2)-ca-2)+"px")+'"></div>').appendTo("body"));e(".xheModalContent",K).css("height",f-(g.modalTitle?e(".xheModalTitle").outerHeight():0)).html(b);h&&pa===6&&(Ga=e("select:visible").css("visibility","hidden"));e(".xheModalClose",K).click(d.removeModal);Fa.show();ca>0&&Ea.show();K.show();setTimeout(function(){K.find("a,input[type=text],textarea").filter(":visible").filter(function(){return e(this).css("visibility")!=="hidden"}).eq(0).focus()},10);ta=true;Ha=i};this.removeModal=function(){Ga&&Ga.css("visibility","visible");K.html("").remove();ca>0&&Ea.remove();Fa.remove();Ha&&Ha();ta=false;Q=d.panelState};this.showDialog=function(a,b){var c=e('<div class="xheDialog"></div>'),f=e(a),i=e("#xheSave",f);if(i.length===1){f.find("input[type=text],select").keypress(function(a){if(a.which===13)return i.click(),false});f.find("textarea").keydown(function(a){if(a.ctrlKey&&a.which===13)return i.click(),false});i.after(' <input type="button" id="xheCancel" value="\u53d6\u6d88" />');e("#xheCancel",f).click(d.hidePanel);if(!g.clickCancelDialog){sa=false;var h=e('<div class="xheFixCancel"></div>').appendTo("body").mousedown(N),j=A.offset();h.css({left:j.left,top:j.top,width:A.outerWidth(),height:A.outerHeight()})}c.mousedown(function(){na=true})}c.append(f);d.showPanel(c,b)};this.showPanel=function(a,b){if(!u.target)return false;m.html("").append(a).css("left",-999).css("top",-999);ba=e(u.target).closest("a").addClass("xheActive");var c=ba.offset(),d=c.left,c=c.top;c+=ba.outerHeight()-1;aa.css({left:d+1,top:c,width:ba.width()}).show();var i=document.documentElement,h=document.body;if(d+m.outerWidth()>(window.pageXOffset||i.scrollLeft||h.scrollLeft)+(i.clientWidth||h.clientWidth))d-=m.outerWidth()-ba.outerWidth();i=g.layerShadow;i>0&&$.css({left:d+i,top:c+i,width:m.outerWidth(),height:m.outerHeight()}).show();if((i=e("#"+ha).offsetParent().css("zIndex"))&&!isNaN(i))$.css("zIndex",parseInt(i,10)+1),m.css("zIndex",parseInt(i,10)+2),aa.css("zIndex",parseInt(i,10)+3);m.css({left:d,top:c}).show();b||setTimeout(function(){m.find("a,input[type=text],textarea").filter(":visible").filter(function(){return e(this).css("visibility")!=="hidden"}).eq(0).focus()},10);Qa=Q=true};this.hidePanel=function(){Q&&(ba.removeClass("xheActive"),$.hide(),aa.hide(),m.hide(),Q=false,sa||(e(".xheFixCancel").remove(),sa=true),Qa=na=false,V=null,d.focus(),d.loadBookmark())};this.exec=function(a){d.hidePanel();var b=ja[a];if(!b)return false;if(u===null){u={};var c=r.find(".xheButton[cmd="+a+"]");if(c.length===1)u.target=c}if(b.e)b.e.call(d);else switch(a=a.toLowerCase(),a){case "cut":try{if(l.execCommand(a),!l.queryCommandSupported(a))throw"Error";}catch(f){alert("\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u4f7f\u7528\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl + X)\u6765\u5b8c\u6210")}break;case "copy":try{if(l.execCommand(a),!l.queryCommandSupported(a))throw"Error";}catch(i){alert("\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u4f7f\u7528\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl + C)\u6765\u5b8c\u6210")}break;case "paste":try{if(l.execCommand(a),!l.queryCommandSupported(a))throw"Error";}catch(m){alert("\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u4f7f\u7528\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl + V)\u6765\u5b8c\u6210")}break;case "pastetext":window.clipboardData?d.pasteText(window.clipboardData.getData("Text",true)):d.showPastetext();break;case "blocktag":var j=[];e.each(gb,function(a,b){j.push({s:"<"+b.n+">"+b.t+"</"+b.n+">",v:"<"+b.n+">",t:b.t})});d.showMenu(j,function(a){d._exec("formatblock",a)});break;case "fontface":var o=[];e.each(hb,function(a,b){b.c=b.c?b.c:b.n;o.push({s:'<span style="font-family:'+b.c+'">'+b.n+"</span>",v:b.c,t:b.n})});d.showMenu(o,function(a){d._exec("fontname",a)});break;case "fontsize":var t=[];e.each(R,function(a,b){t.push({s:'<span style="font-size:'+b.s+';">'+b.t+"("+b.s+")</span>",v:a+1,t:b.t})});d.showMenu(t,function(a){d._exec("fontsize",a)});break;case "fontcolor":d.showColor(function(a){d._exec("forecolor",a)});break;case "backcolor":d.showColor(function(a){h?d._exec("backcolor",a):(Ka(true),d._exec("hilitecolor",a),Ka(false))});break;case "align":d.showMenu(ib,function(a){d._exec(a)});break;case "list":d.showMenu(jb,function(a){d._exec(a)});break;case "link":d.showLink();break;case "anchor":d.showAnchor();break;case "img":d.showImg();break;case "flash":d.showEmbed("Flash",'<div><label for="xheFlashUrl">\u52a8\u753b\u6587\u4ef6: </label><input type="text" id="xheFlashUrl" value="http://" class="xheText" /></div><div><label for="xheFlashWidth">\u5bbd\u3000\u3000\u5ea6: </label><input type="text" id="xheFlashWidth" style="width:40px;" value="480" /> <label for="xheFlashHeight">\u9ad8\u3000\u3000\u5ea6: </label><input type="text" id="xheFlashHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>',"application/x-shockwave-flash","clsid:d27cdb6e-ae6d-11cf-96b8-4445535400000",' wmode="opaque" quality="high" menu="false" play="true" loop="true" allowfullscreen="true"',g.upFlashUrl,g.upFlashExt);break;case "media":d.showEmbed("Media",'<div><label for="xheMediaUrl">\u5a92\u4f53\u6587\u4ef6: </label><input type="text" id="xheMediaUrl" value="http://" class="xheText" /></div><div><label for="xheMediaWidth">\u5bbd\u3000\u3000\u5ea6: </label><input type="text" id="xheMediaWidth" style="width:40px;" value="480" /> <label for="xheMediaHeight">\u9ad8\u3000\u3000\u5ea6: </label><input type="text" id="xheMediaHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>',"application/x-mplayer2","clsid:6bf52a52-394a-11d3-b153-00c04f79faa6",' enablecontextmenu="false" autostart="false"',g.upMediaUrl,g.upMediaExt);break;case "hr":d.pasteHTML("<hr />");break;case "emot":d.showEmot();break;case "table":d.showTable();break;case "source":d.toggleSource();break;case "preview":d.showPreview();break;case "print":U.print();break;case "fullscreen":d.toggleFullscreen();break;case "about":d.showAbout();break;default:d._exec(a)}u=null};this._exec=function(a,b,c){c||d.focus();return b!==Y?l.execCommand(a,false,b):l.execCommand(a,false,null)}};ra.settings={skin:"default",tools:"full",clickCancelDialog:true,linkTag:false,internalScript:false,inlineScript:false,internalStyle:true,inlineStyle:true,showBlocktag:false,forcePtag:true,upLinkExt:"zip,rar,txt",upImgExt:"jpg,jpeg,gif,png",upFlashExt:"swf",upMediaExt:"wmv,avi,wma,mp3,mid",modalWidth:350,modalHeight:220,modalTitle:true,defLinkText:"\u70b9\u51fb\u6253\u5f00\u94fe\u63a5",layerShadow:3,emotMark:false,upBtnText:"\u4e0a\u4f20",cleanPaste:1,hoverExecDelay:100,html5Upload:true,upMultiple:99};window.xheditor=ra;e(function(){e.fn.oldVal=e.fn.val;e.fn.val=function(e){var h=this,m;return e===Y?h[0]&&(m=h[0].xheditor)?m.getSource():h.oldVal():h.each(function(){(m=this.xheditor)?m.setSource(e):h.oldVal(e)})};e("textarea").each(function(){var h=e(this),m=h.attr("class");if(m&&(m=m.match(/(?:^|\s)xheditor(?:\-(m?full|simple|mini))?(?:\s|$)/i)))h.xheditor(m[1]?{tools:m[1]}:null)})})})(jQuery);
